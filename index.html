<!DOCTYPE html>
<html lang="en">
<!--load D3.js v5 library-->
<script src='https://d3js.org/d3.v7.min.js'></script>
<!--load d3-annotation-->
<script src='https://github.com/susielu/d3-annotation/blob/master/d3-annotation.js'></script>
<!--CSS circle objects-->
<style> circle {fill: lightblue; stroke: black;} </style>

<!--When render 'body' element run init-->
<!--<body onload='init()'>-->
<body>
<!--create 300x300 pixel SVG canvas-->
<svg width=300 height=300> </svg>

<!--create html buttons-->
<button type="button" onclick="data()"> All Engine Sizes </button>
<button type="button" onclick="repop4()"> Four Cylinders </button>
<button type = "button" onclick="repop8()"> Eight Cylinders </button>
<button type = "button" onclick="repop12()"> Twelve Cylinders </button>
<button type = "button">
    <a href="https://mohassan99.github.io/mpgVsCyl">Next Slide </a>
</button>
<script>
    // Loads data while allowing other events to enter the queue
    /*  Columns:
        0 "Make"
        1 "Fuel"
        2 "EngineCylinders"
        3 "AverageHighwayMPG"
        4 "AverageCityMPG"
    Rows: ~145 */
    //load data while allowing addition of events to queue
    // async function init() {
    //     const data = await d3.csv('cars2017.csv');
    // }
    // Scaling Equations for x and y:
    var y = d3.scaleLog().domain([10, 150]).range([200, 0]);
    var x = d3.scaleLog().domain([10, 150]).range([0, 200]);

    var margin = 50;
    var height = 200;


    //Takes a dataset outputs plot of circles:
    function update(_data) {
        d3.selectAll("circle").remove();        //d3.selectAll("circle").html = "";
        //delete circles
        d3.select("svg")
            .append("g")
            .attr("transform", "translate(" + margin + "," + (+margin) + ")")
            .selectAll("circle")
            .transition()
            .duration(3000)
            .attr("r", 0)
        ;
        var u = d3.select("svg")
            .append("g")
            .attr("transform", "translate(" + margin + "," + (+margin) + ")")
            .selectAll("circle")
            .data(_data)
        ;

        u
            .enter()
            .append("circle")
            .merge(u)
            .transition()
            .duration(3000)
            .attr("cx", function (d) {
                return x(+d.AverageCityMPG);
            })
            .attr("cy", function (d) {
                return y(+d.AverageHighwayMPG);
            })
            .attr("r", function (d) {
                return 2 + +d.EngineCylinders;
            })
        ;
    }

    //functions to async load data and update the circles
    async function data() {
        const data = await d3.csv('https://flunky.github.io/cars2017.csv');
        // Add annotation to the chart

        return update(data);
    }
    async function repop4() {
        const data4 = await d3.csv('Cars2017_4.csv');
        return update(data4);
    }
    async function repop8() {
        const data8 = await d3.csv('Cars2017_8.csv');
        return update(data8);
    }
    async function repop12() {
        const data12 = await d3.csv('Cars2017_12.csv');
        return update(data12);
    }
// AXES
// use a transform("translate", ..) to move origin to the chart origin within the margins
    d3.select("svg")
        .append("g")
        .attr("transform","translate("+margin+","+margin+")")
        .call(d3.axisLeft(y)
            .tickValues([10, 20, 50, 100])
            .tickFormat(d3.format("~s"))
        )
    ;
    d3.select("svg")
        .append("g")
        .attr("transform","translate("+margin+","+(height+margin)+")")
        .call(d3.axisBottom(x)
            .tickValues([10, 20, 50, 100])
            .tickFormat(d3.format("~s"))
        )
    ;

    update(data);

    // Features of the annotation
    const annotations = [
        {
            note: {
                label: "Here is the annotation label",
                title: "Annotation title"
            },
            x: 150,
            y: 150,
            dy: 150,
            dx: 150
        }
    ]

    const makeAnnotations = d3.annotation()
        .annotations(annotations)
    d3.select("svg")
        .append("g")
        .call(makeAnnotations);


</script>
</body>
</html>
